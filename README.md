
# Loyalty Gofermart

Проект **Loyalty Gofermart** представляет собой систему для управления бонусами и баллами лояльности пользователей.

## Структура проекта

Проект состоит из следующих ключевых компонентов:
- **API** для регистрации пользователей, добавления заказов, получения баланса и списания средств.
- **Миграции** для управления схемой базы данных.
- **Валидация** и авторизация через JWT токены в куках.
- **Хендлеры** для обработки HTTP-запросов.

## Установка и запуск

### 1. Установите зависимости

Перед запуском проекта убедитесь, что у вас установлен Go и все необходимые зависимости.

Для начала клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/loyalty-gofermart.git
cd loyalty-gofermart
```

Затем выполните команду для загрузки зависимостей:
```bash
go mod tidy
```

### 2. Конфигурация окружения

Перед запуском необходимо настроить несколько переменных окружения:

- `SERVER_ADDRESS` — Адрес сервера (по умолчанию `127.0.0.1:8081`).
- `DATABASE_URI` — Строка подключения к базе данных.
- `ACCRUAL_SYSTEM_ADDRESS` — Адрес системы начисления бонусов (по умолчанию `127.0.0.1:8080`).

Вы можете задать эти переменные в вашем окружении или в `.env` файле.

### 3. Запуск миграций

Для запуска миграций используйте команду:

```bash
go run main.go migrate
```

Эта команда применит все миграции базы данных.

### 4. Запуск сервера

Чтобы запустить сервер, используйте команду:

```bash
go run main.go
```

Сервер будет запущен на порту, указанном в переменной `SERVER_ADDRESS` (по умолчанию `127.0.0.1:8081`).

### 5. Тестирование

Для запуска тестов используйте команду:

```bash
go test -v
```

Это запустит все тесты, определенные в проекте.

## API

### 1. Регистрация пользователя

**POST** `/api/user/register`

Запрос:
```json
{
    "login": "user@example.com",
    "password": "securepassword123"
}
```

Ответ:
```json
{
    "id": 1,
    "login": "user@example.com"
}
```

### 2. Авторизация пользователя

**POST** `/api/user/login`

Запрос:
```json
{
    "login": "user@example.com",
    "password": "securepassword123"
}
```

Ответ:
```json
{
    "token": "jwt_token"
}
```

### 3. Добавление заказа

**POST** `/api/user/orders`

Запрос:
```json
{
    "order_number": "2377225624"
}
```

Ответ:
```json
{
    "success": true
}
```

### 4. Получение списка заказов пользователя

**GET** `/api/user/orders`

Ответ:
```json
[
    {
        "number": "2377225624",
        "status": "PROCESSING",
        "uploaded_at": "2025-01-08T15:15:45+03:00"
    }
]
```

### 5. Получение баланса пользователя

**GET** `/api/user/balance`

Ответ:
```json
{
    "current": 500.5,
    "withdrawn": 42
}
```

### 6. Запрос на вывод средств

**POST** `/api/user/balance/withdraw`

Запрос:
```json
{
    "order": "2377225624",
    "sum": 751
}
```

Ответ:
```json
{
    "success": true
}
```

### 7. Получение информации о выводах средств

**GET** `/api/user/withdrawals`

Ответ:
```json
[
    {
        "order": "2377225624",
        "sum": 500,
        "processed_at": "2025-01-08T15:15:45+03:00"
    }
]
```

## Лицензия

Этот проект лицензируется по лицензии MIT. Подробнее см. файл [LICENSE](LICENSE).
